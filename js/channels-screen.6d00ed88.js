(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["channels-screen"],{"0d21":function(t,e,s){},"3fe9":function(t,e,s){},"48d0":function(t,e,s){"use strict";s("0d21")},"6e74":function(t,e,s){"use strict";s.d(e,"d",(function(){return i})),s.d(e,"a",(function(){return n})),s.d(e,"c",(function(){return a})),s.d(e,"b",(function(){return o}));class i{constructor(t,e,s,i){this.userId=t,this.userName=e,this.text=s.trim(),this.source=i}}class n{constructor(t,e,s,i,n){this.userId=t,this.userName=e,this.amount=s,this.type=i,this.source=n}}class a{constructor(t,e,s){this.userId=t,this.userName=e,this.source=s}}class o{constructor(t,e,s){this.userId=t,this.userName=e,this.source=s}}},b6ff:function(t,e,s){"use strict";s("3fe9")},b941:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"channelScreen"},[e("h1",[t._v(t._s(t._f("t")("whoAreYou",t.$store.state.locale)))]),e("div",{staticClass:"channels-description"},[t._v(t._s(t._f("t")("channelsDesc",t.$store.state.locale)))]),e("div",{staticClass:"fields"},[e("div",{staticClass:"field"},[e("div",{staticClass:"sign twitch"},[t._v("Twitch")]),e("InputField",{ref:"twitchChannel",attrs:{placeholder:t._f("t")("channelName",t.$store.state.locale)},model:{value:t.twitchChannel,callback:function(e){t.twitchChannel=e},expression:"twitchChannel"}})],1),e("div",{staticClass:"field"},[e("div",{staticClass:"sign youtube"},[t._v("YouTube")]),e("InputField",{attrs:{placeholder:t._f("t")("streamURL",t.$store.state.locale)},model:{value:t.youtubeUrl,callback:function(e){t.youtubeUrl=e},expression:"youtubeUrl"}})],1)]),e("div",[e("BigButton",{on:{onClick:t.connect}},[t._v(t._s(t._f("t")("play",t.$store.state.locale))+" >")])],1)])},n=[],a=(s("14d9"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"inputField"},[e("input",{ref:"inputField",attrs:{type:"text",placeholder:t.placeholder},domProps:{value:t.val},on:{input:function(e){return t.$emit("input",e.target.value)}}})])}),o=[],l={name:"InputField",props:{placeholder:String,val:String},methods:{getImgUrl(t){var e=s("7016");return e("./"+t+".png")}}},r=l,h=(s("48d0"),s("2877")),c=Object(h["a"])(r,a,o,!1,null,null,null),u=c.exports,d=s("6932"),p=s("e342"),m=s("c745"),w={name:"channelScreen",components:{InputField:u,BigButton:d["a"]},data(){return{twitchChannel:"",youtubeUrl:""}},computed:{local(){return this.$root.local}},methods:{connect(){""==this.twitchChannel&&""==this.youtubeUrl||(""!=this.twitchChannel&&(this.$services.twitch=new p["a"](this.twitchChannel),this.$services.twitch.connect(),this.$store.commit("setTwitchName",this.twitchChannel)),""!=this.youtubeUrl&&(this.$services.youtube=new m["a"](this.youtubeUrl),this.$services.youtube.connect()),this.$router.push("/settings"))}},mounted(){this.$refs.twitchChannel.$refs.inputField.value=this.$store.state.twitchName,this.twitchChannel=this.$store.state.twitchName}},g=w,v=(s("b6ff"),Object(h["a"])(g,i,n,!1,null,null,null));e["default"]=v.exports},c745:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));s("14d9");var i=s("6e74");class n{constructor(t){this.apikey="wgnn-wBx-_VT5Nu996o8ylc-t786swbRBySazIA".split("").reverse().join(""),this.streamURL=new URL(t),this.lastMessagesId=[],this.vuewersCount=0,this.channel=null,this.nextPageToken=null,this.consoleStyle="background-color: #FF0000; color: #FFFFFF; border-radius: 100px;padding: 1px 4px;","www.youtube.com"==this.streamURL.hostname||"youtube.com"==this.streamURL.hostname?this.streamId=this.streamURL.searchParams.get("v"):this.streamId=this.streamURL.pathname.substr(1),this.events={onMessage:()=>{},onSub:()=>{},onFollower:()=>{},onSuperchat:()=>{},onConnect:()=>{},onDisconnect:()=>{},onError:()=>{}}}connect(){fetch("https://www.googleapis.com/youtube/v3/videos?id="+this.streamId+"&part=snippet,liveStreamingDetails&key="+this.apikey).then(t=>t.json()).then(t=>{this.chatId=t.items[0].liveStreamingDetails.activeLiveChatId,this.channel=t.items[0].snippet.channelId,this._updateChat(),this.updTimer=setInterval(this._updateChat.bind(this),5e3),this._log("Connected to "+this.chatId),this._log("Channel id: "+this.channel)}).catch(t=>{this._signal("onError",t)})}disconnect(){clearInterval(this.updTimer),this._signal("onDisconnect",null)}updateViewers(){return fetch(`https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${this.streamId}&fields=items%2FliveStreamingDetails&key=${this.apikey}`).then(t=>t.json()).then(t=>{var e;(null===(e=t.items)||void 0===e?void 0:e.length)>0&&(this.viewersCount=t.items[0].liveStreamingDetails.concurrentViewers)})}_updateChat(){fetch("https://www.googleapis.com/youtube/v3/liveChat/messages?liveChatId="+this.chatId+"&part=id,snippet,authorDetails&maxResults=100&key="+this.apikey+(this.nextPageToken?"&nextPageToken="+this.nextPageToken:"")).then(t=>t.json()).then(t=>{t.items.forEach(e=>{if(null!==t&&void 0!==t&&t.nextPageToken&&(this.nextPageToken=t.nextPageToken),!this.lastMessagesId.includes(e.id)){if(this.lastMessagesId.length>1e3&&(this.lastMessagesId=this.lastMessagesId.splice(100,900)),this.lastMessagesId.push(e.id),"textMessageEvent"!=e.snippet.type)return"superChatEvent"==e.snippet.type?(this._signal("onSuperchat",new i["a"](e.snippet.authorChannelId,e.authorDetails.displayName,e.snippet.superChatDetails.tier>5?5:e.snippet.superChatDetails.tier,1,"yt")),void this._log("Get donate from "+e.authorDetails.displayName+" - "+e.snippet.superChatDetails.amountMicros)):"superStickerEvent"==e.snippet.type?(this._signal("onSuperchat",new i["a"](e.snippet.authorChannelId,e.authorDetails.displayName,e.snippet.superStickerDetails.tier>5?5:e.snippet.superStickerDetails.tier,1,"yt")),void this._log("Get donate from "+e.authorDetails.displayName+" - "+e.snippet.superChatDetails.amountMicros)):"newSponsorEvent"==e.snippet.type?(this._signal("onSub",new i["c"](e.snippet.authorChannelId,e.authorDetails.displayName,"yt")),void this._log("New subscriber "+e.authorDetails.displayName)):void 0;this._signal("onMessage",new i["d"](e.snippet.authorChannelId,e.authorDetails.displayName,e.snippet.displayMessage,"yt"))}})})}_log(t){console.log("%cYoutube%c "+t,this.consoleStyle,"")}_signal(t,e){this.events[t](e)}}},e342:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));s("14d9");var i=s("6e74");class n{constructor(t){this.channel=t,this.userId=null,this.viewersCount=0,this.apikey="vtr91vw1dzji7piypq7r13itr6is2i",this.botname="justinfan666",this.server="irc-ws.chat.twitch.tv",this.consoleStyle="background-color: #6441A4; color: #FFFFFF; border-radius: 100px;padding: 1px 4px;",this.lastFollowers=[],this.plannedDisconnect=!1,this.events={onMessage:()=>{},onSub:()=>{},onFollower:()=>{},onBits:()=>{},onConnect:()=>{},onDisconnect:()=>{},onError:()=>{}}}connect(){window.location.protocol.includes("https")?this.webSocket=new WebSocket("wss://"+this.server+":443/","irc"):this.webSocket=new WebSocket("ws://"+this.server+":80/","irc"),this.webSocket.onmessage=this.onMessage.bind(this),this.webSocket.onerror=this.onError.bind(this),this.webSocket.onclose=this.onClose.bind(this),this.webSocket.onopen=this.onOpen.bind(this)}startCheckNewFollowers(){this.checkFollowersFrom=Date.now();let t=setInterval((()=>{this.userId&&(clearInterval(t),this._checkFollowers(),this.updFollowersTimer=setInterval(this._checkFollowers.bind(this),18e4))}).bind(this),500)}stopCheckNewFollowers(){clearInterval(this.updFollowersTimer)}updateViewers(){return fetch("https://api.twitch.tv/helix/streams?user_login="+this.channel,{headers:{"Client-ID":this.apikey}}).then(t=>t.json()).then(t=>{t.stream&&(this.viewersCount=t.stream.viewers)})}onMessage(t){if(null==t)return;let e=this._parseMessage(t.data);if(null!=e)if("PING"!==e.command)if("ROOMSTATE"!==e.command)if("USERNOTICE"==e.command&&(e.tags["msg-id"].includes("sub")||e.tags["msg-id"].includes("gift")))e.tags.hasOwnProperty("msg-param-recipient-display-name")?(this._signal("onSub",new i["c"](e.tags["msg-param-recipient-id"],e.tags["msg-param-recipient-display-name"],"tw")),this._log("New gifted subscriber "+e.tags["msg-param-recipient-display-name"])):this._signal("onSub",new i["c"](e.tags["user-id"],e.tags["display-name"],"tw")),this._log("New subscriber "+e.tags["display-name"]);else if("PRIVMSG"==e.command&&e.tags.hasOwnProperty("bits")){let t=parseFloat(e.tags["bits"]),s=1,n=t>10?10:t;if(t<10)return;t/100>=1&&(s=2,n=Math.round(t/100)),t/1e3>=1&&(s=3,n=Math.round(t/1e3)),t/5e3>=1&&(s=4,n=Math.round(t/5e3)),t/1e4>=1&&(s=5,n=Math.round(t/1e4)),n=n>10?10:n,this._signal("onBits",new i["a"](e.tags["user-id"],e.tags["display-name"],n,s,"tw")),this._log("Get donate from "+e.tags["display-name"]+" - "+e.tags["bits"])}else"PRIVMSG"==e.command&&this._signal("onMessage",new i["d"](e.tags["user-id"],e.tags["display-name"],e.message,"tw"));else this.userId=e.tags["room-id"];else this.webSocket.send("PONG :"+e.message)}onError(t){this._signal("onError",t),this._log("Error: "),console.log(t)}onClose(){this.plannedDisconnect?this._signal("onDisconnect"):this.connect(),this._log("Disconnect from websocket")}onOpen(){null!==this.webSocket&&1===this.webSocket.readyState&&(this._log("Connected to websocket"),this.webSocket.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership"),this.webSocket.send("NICK "+this.botname),this.webSocket.send("JOIN #"+this.channel.toLowerCase()),this._signal("onConnect"))}close(){this.plannedDisconnect=!0,this.webSocket&&this.webSocket.close()}_signal(t,e){this.events[t](e)}_checkFollowers(){fetch("https://api.twitch.tv/helix/users/follows?first=100&to_id="+this.userId,{headers:{"Client-ID":this.apikey}}).then(t=>t.json()).then(t=>{t.data.forEach(t=>{this.lastFollowers.includes(t.from_id)||(this.lastFollowers>1e3&&(this.lastFollowers=this.lastFollowers.splice(100,900)),this.lastFollowers.push(t.from_id),new Date(t.followed_at)<this.checkFollowersFrom||(this._signal("onFollower",new i["b"](t.from_id,t.from_name,"tw")),this._log("New follower "+t.from_name)))})})}_log(t){console.log("%cTwitch%c "+t,this.consoleStyle,"")}_parseMessage(t){let e={message:null,tags:null,command:null,original:t,channel:null,username:null};if("@"===t[0]){let s=t.indexOf(" "),i=t.indexOf(" ",s+1),n=t.indexOf(" ",i+1),a=t.indexOf(" ",n+1),o=t.indexOf(":",a+1),l=null!=t.slice(0,s)?t.slice(0,s).substr(1).split(";"):[],r={};l.forEach(t=>{let e=t.split("=");r[e[0]]=e[1]}),e.tags=r,e.username=t.slice(s+2,t.indexOf("!")),e.command=t.slice(i+1,n),e.channel=t.slice(n+1,a),e.message=t.slice(o+1)}else t.startsWith("PING")&&(e.command="PING",e.message=t.split(":")[1]);return e}}}}]);
//# sourceMappingURL=channels-screen.6d00ed88.js.map